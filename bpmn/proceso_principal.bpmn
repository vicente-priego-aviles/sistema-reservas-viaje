<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:zeebe="http://camunda.org/schema/zeebe/1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:modeler="http://camunda.org/schema/modeler/1.0" id="Definitions_ProcesoPrincipal" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="5.37.0" modeler:executionPlatform="Camunda Cloud" modeler:executionPlatformVersion="8.7.0">
  <bpmn:process id="proceso-principal" name="Proceso Principal de Reserva de Viaje" isExecutable="true">
    <bpmn:startEvent id="evento-inicio-solicitud-reserva" name="📩 Solicitud de Reserva de Viaje">
      <bpmn:extensionElements>
        <zeebe:ioMapping>
          <zeebe:output source="=uuid()" target="reservaId" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:outgoing>flujo-inicio-a-validar-datos</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:serviceTask id="validar-datos-entrada" name="✅ Validar Datos de Entrada">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="validar-datos-entrada" retries="3" />
      </bpmn:extensionElements>
      <bpmn:incoming>flujo-inicio-a-validar-datos</bpmn:incoming>
      <bpmn:outgoing>flujo-validar-a-gestion-cliente</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:boundaryEvent id="evento-error-validacion-datos" name="❌ Error Validación" attachedToRef="validar-datos-entrada">
      <bpmn:outgoing>flujo-error-validacion-a-fin</bpmn:outgoing>
      <bpmn:errorEventDefinition id="ErrorEventDef_ValidacionDatos" errorRef="Error_ValidacionDatos" />
    </bpmn:boundaryEvent>
    <bpmn:endEvent id="evento-fin-datos-invalidos" name="❌ Datos Inválidos">
      <bpmn:incoming>flujo-error-validacion-a-fin</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:boundaryEvent id="evento-error-gestion-cliente" name="❌ Error Cliente" attachedToRef="call-activity-gestion-cliente">
      <bpmn:outgoing>flujo-error-cliente-a-fin</bpmn:outgoing>
      <bpmn:errorEventDefinition id="ErrorEventDef_GestionCliente" />
    </bpmn:boundaryEvent>
    <bpmn:endEvent id="evento-fin-error-gestion-cliente" name="❌ Error en Gestión de Cliente">
      <bpmn:incoming>flujo-error-cliente-a-fin</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:userTask id="revisar-datos-entrada" name="📋 Revisar Datos de Entrada">
      <bpmn:extensionElements>
        <zeebe:assignmentDefinition assignee="demo" />
      </bpmn:extensionElements>
      <bpmn:incoming>flujo-gestion-cliente-a-revisar-datos</bpmn:incoming>
      <bpmn:outgoing>flujo-revisar-datos-a-proceso-reserva</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:callActivity id="call-activity-proceso-reserva" name="🎟️ Proceso de Reserva">
      <bpmn:extensionElements>
        <zeebe:calledElement processId="subproceso-proceso-reserva" propagateAllChildVariables="true" />
      </bpmn:extensionElements>
      <bpmn:incoming>flujo-revisar-datos-a-proceso-reserva</bpmn:incoming>
      <bpmn:outgoing>flujo-proceso-reserva-a-pago</bpmn:outgoing>
    </bpmn:callActivity>
    <bpmn:sendTask id="notificar-cliente-reserva-fallida" name="📧 Notificar Cliente: Reserva Fallida">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="notificar-reserva-fallida" />
      </bpmn:extensionElements>
      <bpmn:incoming>flujo-error-reserva-a-notificar</bpmn:incoming>
      <bpmn:outgoing>flujo-notificar-a-fin-reserva-fallida</bpmn:outgoing>
    </bpmn:sendTask>
    <bpmn:endEvent id="evento-fin-reserva-fallida" name="❌ Reserva Fallida">
      <bpmn:incoming>flujo-notificar-a-fin-reserva-fallida</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:callActivity id="call-activity-proceso-pago" name="💳 Proceso de Pago">
      <bpmn:extensionElements>
        <zeebe:calledElement processId="subproceso-pago" propagateAllChildVariables="true" />
      </bpmn:extensionElements>
      <bpmn:incoming>flujo-proceso-reserva-a-pago</bpmn:incoming>
      <bpmn:outgoing>flujo-pago-a-fin-exitoso</bpmn:outgoing>
    </bpmn:callActivity>
    <bpmn:boundaryEvent id="evento-error-proceso-pago" name="❌ Error Pago" attachedToRef="call-activity-proceso-pago">
      <bpmn:outgoing>flujo-error-pago-a-fin</bpmn:outgoing>
      <bpmn:errorEventDefinition id="ErrorEventDef_ProcesoPago" />
    </bpmn:boundaryEvent>
    <bpmn:endEvent id="evento-fin-error-pago" name="❌ Pago Fallido">
      <bpmn:incoming>flujo-error-pago-a-fin</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:endEvent id="evento-fin-solicitud-completada" name="✅ Solicitud de Viaje Completada">
      <bpmn:incoming>flujo-pago-a-fin-exitoso</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="flujo-inicio-a-validar-datos" sourceRef="evento-inicio-solicitud-reserva" targetRef="validar-datos-entrada" />
    <bpmn:sequenceFlow id="flujo-validar-a-gestion-cliente" sourceRef="validar-datos-entrada" targetRef="call-activity-gestion-cliente" />
    <bpmn:sequenceFlow id="flujo-gestion-cliente-a-revisar-datos" sourceRef="call-activity-gestion-cliente" targetRef="revisar-datos-entrada" />
    <bpmn:sequenceFlow id="flujo-revisar-datos-a-proceso-reserva" sourceRef="revisar-datos-entrada" targetRef="call-activity-proceso-reserva" />
    <bpmn:sequenceFlow id="flujo-proceso-reserva-a-pago" sourceRef="call-activity-proceso-reserva" targetRef="call-activity-proceso-pago" />
    <bpmn:sequenceFlow id="flujo-pago-a-fin-exitoso" sourceRef="call-activity-proceso-pago" targetRef="evento-fin-solicitud-completada" />
    <bpmn:sequenceFlow id="flujo-error-validacion-a-fin" sourceRef="evento-error-validacion-datos" targetRef="evento-fin-datos-invalidos" />
    <bpmn:sequenceFlow id="flujo-error-cliente-a-fin" sourceRef="evento-error-gestion-cliente" targetRef="evento-fin-error-gestion-cliente" />
    <bpmn:sequenceFlow id="flujo-notificar-a-fin-reserva-fallida" sourceRef="notificar-cliente-reserva-fallida" targetRef="evento-fin-reserva-fallida" />
    <bpmn:sequenceFlow id="flujo-error-pago-a-fin" sourceRef="evento-error-proceso-pago" targetRef="evento-fin-error-pago" />
    <bpmn:callActivity id="call-activity-gestion-cliente" name="👤 Gestión de Cliente">
      <bpmn:extensionElements>
        <zeebe:calledElement processId="subproceso-gestion-cliente" propagateAllChildVariables="true" />
      </bpmn:extensionElements>
      <bpmn:incoming>flujo-validar-a-gestion-cliente</bpmn:incoming>
      <bpmn:outgoing>flujo-gestion-cliente-a-revisar-datos</bpmn:outgoing>
    </bpmn:callActivity>
    <bpmn:sequenceFlow id="flujo-error-reserva-a-notificar" sourceRef="Event_1rjxxez" targetRef="notificar-cliente-reserva-fallida" />
    <bpmn:boundaryEvent id="Event_1rjxxez" name="❌ Error Reserva" attachedToRef="call-activity-proceso-reserva">
      <bpmn:outgoing>flujo-error-reserva-a-notificar</bpmn:outgoing>
      <bpmn:errorEventDefinition id="ErrorEventDefinition_1bfojac" />
    </bpmn:boundaryEvent>
  </bpmn:process>
  <bpmn:error id="Error_ValidacionDatos" name="Error Validación Datos" errorCode="ERROR_VALIDACION_DATOS" />
  <bpmn:error id="Error_ReservaFallida" name="Error Reserva Fallida" errorCode="ERROR_RESERVA_FALLIDA" />
  <bpmndi:BPMNDiagram id="BPMNDiagram_ProcesoPrincipal">
    <bpmndi:BPMNPlane id="BPMNPlane_ProcesoPrincipal" bpmnElement="proceso-principal">
      <bpmndi:BPMNShape id="Shape_evento-inicio-solicitud-reserva" bpmnElement="evento-inicio-solicitud-reserva">
        <dc:Bounds x="172" y="122" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="148" y="165" width="84" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Shape_validar-datos-entrada" bpmnElement="validar-datos-entrada">
        <dc:Bounds x="260" y="100" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Shape_evento-fin-datos-invalidos" bpmnElement="evento-fin-datos-invalidos">
        <dc:Bounds x="362" y="262" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="356" y="303" width="48" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Shape_evento-fin-error-gestion-cliente" bpmnElement="evento-fin-error-gestion-cliente">
        <dc:Bounds x="548" y="262" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="537" y="306" width="58" height="40" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Shape_revisar-datos-entrada" bpmnElement="revisar-datos-entrada">
        <dc:Bounds x="560" y="100" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Shape_call-activity-proceso-reserva" bpmnElement="call-activity-proceso-reserva">
        <dc:Bounds x="710" y="100" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Shape_notificar-cliente-reserva-fallida" bpmnElement="notificar-cliente-reserva-fallida">
        <dc:Bounds x="750" y="290" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Shape_evento-fin-reserva-fallida" bpmnElement="evento-fin-reserva-fallida">
        <dc:Bounds x="1012" y="312" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1001" y="355" width="60" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Shape_call-activity-proceso-pago" bpmnElement="call-activity-proceso-pago">
        <dc:Bounds x="860" y="100" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Shape_evento-fin-error-pago" bpmnElement="evento-fin-error-pago">
        <dc:Bounds x="1012" y="232" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="988" y="275" width="79" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Shape_evento-fin-solicitud-completada" bpmnElement="evento-fin-solicitud-completada">
        <dc:Bounds x="1012" y="122" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="986" y="86" width="88" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Shape_call-activity-gestion-cliente" bpmnElement="call-activity-gestion-cliente">
        <dc:Bounds x="410" y="100" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Shape_evento-error-proceso-pago" bpmnElement="evento-error-proceso-pago">
        <dc:Bounds x="942" y="162" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="964" y="203" width="71" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Shape_evento-error-gestion-cliente" bpmnElement="evento-error-gestion-cliente">
        <dc:Bounds x="492" y="162" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="526" y="203" width="80" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Shape_evento-error-validacion-datos" bpmnElement="evento-error-validacion-datos">
        <dc:Bounds x="292" y="162" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="325" y="196" width="50" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1mp78mk_di" bpmnElement="Event_1rjxxez">
        <dc:Bounds x="772" y="162" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="806" y="203" width="88" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Edge_flujo-inicio-a-validar-datos" bpmnElement="flujo-inicio-a-validar-datos">
        <di:waypoint x="208" y="140" />
        <di:waypoint x="260" y="140" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Edge_flujo-validar-a-gestion-cliente" bpmnElement="flujo-validar-a-gestion-cliente">
        <di:waypoint x="360" y="140" />
        <di:waypoint x="410" y="140" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Edge_flujo-gestion-cliente-a-revisar-datos" bpmnElement="flujo-gestion-cliente-a-revisar-datos">
        <di:waypoint x="510" y="140" />
        <di:waypoint x="560" y="140" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Edge_flujo-revisar-datos-a-proceso-reserva" bpmnElement="flujo-revisar-datos-a-proceso-reserva">
        <di:waypoint x="660" y="140" />
        <di:waypoint x="710" y="140" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Edge_flujo-proceso-reserva-a-pago" bpmnElement="flujo-proceso-reserva-a-pago">
        <di:waypoint x="810" y="140" />
        <di:waypoint x="860" y="140" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Edge_flujo-pago-a-fin-exitoso" bpmnElement="flujo-pago-a-fin-exitoso">
        <di:waypoint x="960" y="140" />
        <di:waypoint x="1012" y="140" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Edge_flujo-error-validacion-a-fin" bpmnElement="flujo-error-validacion-a-fin">
        <di:waypoint x="310" y="198" />
        <di:waypoint x="310" y="280" />
        <di:waypoint x="362" y="280" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Edge_flujo-error-cliente-a-fin" bpmnElement="flujo-error-cliente-a-fin">
        <di:waypoint x="510" y="198" />
        <di:waypoint x="510" y="280" />
        <di:waypoint x="548" y="280" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Edge_flujo-notificar-a-fin-reserva-fallida" bpmnElement="flujo-notificar-a-fin-reserva-fallida">
        <di:waypoint x="850" y="330" />
        <di:waypoint x="1012" y="330" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Edge_flujo-error-pago-a-fin" bpmnElement="flujo-error-pago-a-fin">
        <di:waypoint x="960" y="198" />
        <di:waypoint x="960" y="250" />
        <di:waypoint x="1012" y="250" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1l0ivq1_di" bpmnElement="flujo-error-reserva-a-notificar">
        <di:waypoint x="790" y="198" />
        <di:waypoint x="790" y="290" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
